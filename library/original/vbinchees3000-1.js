(_=>{g=globalThis.eng||(globalThis.eng={p:2e8,v:[],dbL:new Float32Array(1<<15),dbR:new Float32Array(1<<15),di:0,init:1,rv:{cl:new Float32Array(1<<14),cr:new Float32Array(1<<14),cdl:[2597,3217,3541,4447],cdr:[2699,3019,3823,4241],cgi:0,al:new Float32Array(8192),ar:new Float32Array(8192),adl:[751,997],adr:[883,1129],ai:0}});g.p=~~(g.p*3);R=(g.p&65535)/65535;s=5E4,tm=t/s,Q=2*PI;nv=n0=>(b=650+R*1200,rat=[.5+R/50,1+R/250,2.01+R*.01,2.72+R*.015,3.9+R*.018,5.1+R/50,6.8+R/40],amps=[.45,1,.65,.5,.38,.25,.18].map(a=>a*(.75+R/2)),decs=[.7+.3*R,.35+R/5,.28+.15*R,.22+.12*R,.18+R/10,.12+.08*R,.09+.06*R],pm=2+6*R,am=.1+.35*R,sA=.0008+R*.0015,sD=.2+R*.4,sS=.15+R/5,sR=1.6+R,{t0:n0,pan:(R*2-1)*(.35+.65*R),base:b,ratios:rat,amps:amps,decs:decs,pmDepth:pm,amDepth:am,ph:rat.map(()=>R*Q),mph:rat.map(()=>R*Q),strikeA:sA,strikeD:sD,strikeS:sS,strikeR:sR,life:1});g.init||(g.init=1,Array.from({length:12},(_,i)=>g.v.push(nv(t+i*32))));sp=max(1,s/8);t%sp||g.v.length>=15||(beat=t/sp,burst=beat%16==0||beat%13==0,g.v.push(nv(t)),(burst||g.v.length<12)&&(g.v.push(nv(t+7)),g.v.push(nv(t+13))));roomL=sin(t/(s*2.7))/25,roomR=sin(t/(s*3.9)+1.3)*.07,L=0,Rr=0;for(i=g.v.length;i--;)v=g.v[i],age=(t-v.t0)/s,att=min(1,age/(v.strikeA||(v.strikeA=.004+.003*R))),env=min(1,att)*(.65*exp(-age*(v.strikeD||(v.strikeD=2+R)))+.35*(v.strikeS||(v.strikeS=.35+.3*R)))*exp(-max(0,age-1)*(v.strikeR||(v.strikeR=1.6+R))),out=0,(()=>{for(k=0;k<7;k++)f=v.base*v.ratios[k],v.mph[k]+=Q*(f/2)/s,pmv=sin(v.mph[k])*v.pmDepth,v.ph[k]+=Q*f/s,amv=1+v.amDepth*sin(v.ph[k]/2+.37*k),out+=sin(v.ph[k]+pmv*.0033)*v.amps[k]*amv*exp(-age*(2.5+8*v.decs[k]))})(),out*=env,lp=(1-v.pan+roomL)/2,rp=(1+v.pan+roomR)/2,L+=out*lp,Rr+=out*rp,(env<.0008&&age>3.5)&&g.v.splice(i,1);preDel=37+(sin(t/11840)/2+.5)*73;i0=g.di;L+=((g.dbL[(i0-preDel+32768)%32768]||0)/4);Rr/=2,+((g.dbR[(i0-(preDel+3)+32768)%32768]||0)/4);g.dbL[i0]=L+g.dbL[i0]*.62;g.dbR[i0]=Rr+g.dbR[i0]*.62;g.di=(i0+1)%32768;rv=g.rv,rl=0,rr=0;for(i=0;i<4;i++)li=(rv.cgi-rv.cdl[i]+16384)%16384,ri=(rv.cgi-rv.cdr[i]+16384)%16384,dl=rv.cl[li],dr=rv.cr[ri],damp=.75+sin(t/(s*(.9+i/5)))/10,rl+=dl*(.22+.06*i),rr+=dr*(.22+.06*i),rv.cl[rv.cgi]=(L+rl*.74)*damp,rv.cr[rv.cgi]=(Rr+rr*.74)*damp,rv.cgi=(rv.cgi+1)%16384;for(j=0;j<2;j++)aiL=(rv.ai-rv.adl[j]+8192)%8192,aiR=(rv.ai-rv.adr[j]+8192)%8192,xL=rl,xR=rr,bufL=rv.al[aiL]/1.6,bufR=rv.ar[aiR]/1.6,yL=-.67*xL+bufL,yR=-.67*xR+bufR,rv.al[rv.ai]=xL+.67*yL,rv.ar[rv.ai]=xR+.67*yR,rl=yL,rr=yR,rv.ai=(rv.ai+1)%8192;oL=L*.72+rl*.85+g.dbL[(g.di+31815)%32768]*.18;oR=Rr*.72+rr*.85+g.dbR[(g.di+31721)%32768]*.18;return[atan(oL)/2,atan(oR)/2]})()
